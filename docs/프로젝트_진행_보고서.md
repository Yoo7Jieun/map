# 은하수 관측 가이드 웹서비스 - 프로젝트 진행 보고

## 1. 프로젝트 개요

**프로젝트명:** 은하수 관측 가이드 웹서비스

**목적:** 국내 은하수 관측 최적 장소 및 시간 안내

**대상 사용자:** 천체 사진 촬영자, 별 관측 애호가

## 2. 기술 스택 변경

### 2.1 초기 계획 (v1)

| 분류       | 기술                 |
| ---------- | -------------------- |
| 지도       | Kakao Maps SDK       |
| 프레임워크 | Next.js (App Router) |
| 데이터     | 자체 관측지 DB (CSV) |

### 2.2 변경 후 (v2 - 현재)

| 분류          | 기술                    | 변경 이유                          |
| ------------- | ----------------------- | ---------------------------------- |
| 지도 렌더링   | React-Leaflet           | 오픈소스, 커스터마이징 자유도 높음 |
| 베이스맵      | VWorld WMTS             | 한국어 라벨 지원                   |
| 광공해 데이터 | NASA VIIRS Black Marble | 실제 위성 관측 데이터 활용         |
| 천문 계산     | astronomy-engine        | 클라이언트 사이드 실시간 계산      |
| 날씨 API      | 기상청 단기예보 API     | 국내 날씨 정확도 높음              |

## 3. 시스템 아키텍처

### 3.1 지도 레이어 구조

- Layer 1 (Base): VWorld 베이스맵 - 한국어 지명 표시
- Layer 2 (Overlay): NASA VIIRS 광공해 오버레이 - 토글 ON/OFF 가능
- Layer 3 (Interactive): 사용자 선택 마커 - 클릭 위치 표시

### 3.2 데이터 흐름

1. 사용자가 지도에서 위치 클릭
2. 클라이언트에서 천문 정보 실시간 계산 (astronomy-engine)
3. 서버 API를 통해 기상청 날씨 정보 조회
4. InfoPanel에 통합 정보 표시

## 4. 주요 기능

### 4.1 광공해 시각화

- NASA Black Marble 2016 위성 데이터 사용
- 줌 레벨 8까지 지원 (위성 데이터 해상도 한계)
- 사용자가 토글 버튼으로 ON/OFF 전환 가능

### 4.2 천문 정보 (실시간 계산)

- 달 위상: 삭, 초승달, 상현, 보름 등
- 달 밝기: 0-100%
- 달 고도: 지평선 기준 각도
- 은하수 중심 고도 및 방위각
- 관측 적합도 점수: 0-100점

### 4.3 기상 정보

- 하늘 상태: 맑음, 구름많음, 흐림
- 구름량: 약 20%, 60%, 90%
- 기온 (°C)
- 습도 (%)
- 날씨 기반 관측 조건 평가: 관측 최적 / 관측 가능 / 관측 부적합

### 4.4 네비게이션 연동

- 카카오맵 길찾기 버튼
- 모바일: 카카오맵 앱 실행
- PC: 카카오맵 웹 페이지 열기

## 5. 컴포넌트 구조

### 5.1 페이지

- app/page.tsx: 메인 페이지
- app/api/weather/route.ts: 기상청 API 프록시

### 5.2 컴포넌트

- MapWrapper.tsx: SSR 방지를 위한 동적 임포트 래퍼
- LeafletMap.tsx: 메인 지도 컴포넌트 (VWorld + NASA 레이어)
- ControlPanel.tsx: 광공해 레이어 토글 버튼
- InfoPanel.tsx: 정보 패널 (좌표, 천문, 날씨 정보)

### 5.3 라이브러리

- lib/astronomy.ts: 천문 계산 함수 (astronomy-engine 활용)
- lib/coordConvert.ts: 좌표 변환 (WGS84 ↔ 기상청 격자좌표)

## 6. 해결한 기술적 이슈

### 6.1 VWorld 타일 로딩 실패

- 원인: API 키에 공백 포함, domain 파라미터 누락
- 해결: URL에 ?domain=localhost 파라미터 추가

### 6.2 Tailwind CSS 스타일 미적용

- 원인: Tailwind CSS v4 호환성 문제
- 해결: 컴포넌트별 인라인 스타일로 전환

### 6.3 정보 패널이 지도 아래 숨김

- 원인: Leaflet 내부 z-index와 충돌
- 해결: 패널 z-index를 9999로 상향 조정

### 6.4 서버 사이드 렌더링(SSR) 에러

- 원인: Leaflet이 브라우저 window 객체 필요
- 해결: Next.js dynamic import + ssr: false 옵션 적용

## 7. 남은 작업

### 7.1 우선순위 높음

- 기상청 API 키 재발급 (현재 인증 오류 발생)

### 7.2 우선순위 중간

- 추천 관측지 마커 추가 (기존 CSV 데이터 활용)
- 시간대별 관측 조건 예측 기능

### 7.3 우선순위 낮음

- 모바일 UI 최적화
- 사용자 즐겨찾기 기능

## 8. 기술적 성과

- 카카오맵 종속성 제거 → 오픈소스 기반 스택으로 전환
- NASA 위성 데이터를 활용한 광공해 시각화 구현
- 클라이언트 사이드 천문 계산으로 서버 부하 최소화
- 컴포넌트 분리를 통한 코드 유지보수성 향상

## 9. 스크린샷

(스크린샷 추가 예정)

- 메인 지도 화면
- 광공해 레이어 ON 상태
- 정보 패널 (천문 정보 + 날씨)

## 10. 참고 자료

- React-Leaflet: https://react-leaflet.js.org/
- VWorld: https://www.vworld.kr/
- NASA GIBS: https://earthdata.nasa.gov/
- astronomy-engine: https://github.com/cosinekitty/astronomy
- 기상청 API: https://www.data.go.kr/
